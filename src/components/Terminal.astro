<div class="mx-auto my-8 w-full max-w-4xl">
  <p class="mb-2 font-mono text-xs text-emerald-400/60">
    simulated terminal output
  </p>

  <div
    class="rounded-lg border border-emerald-400/30 bg-black/95 transition-shadow duration-300 hover:shadow-[0_0_12px_rgba(0,255,136,.25)]"
  >
    <pre
      class="m-0 h-64 overflow-auto p-4 font-mono text-[13px] leading-relaxed text-emerald-400"
      id="terminal-pre"
    ><span id="terminal-output"></span><span class="cursor" id="terminal-cursor">â–ˆ</span></pre>
  </div>
</div>

<style>
  .cursor {
    animation: blink 1.2s steps(1, end) infinite;
    color: #00ff88;
    opacity: 0.85;
  }

  @keyframes blink {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0;
    }
  }

  #terminal-pre {
    scrollbar-width: thin;
    scrollbar-color: #00ff88 #000;
  }

  #terminal-pre::-webkit-scrollbar {
    width: 6px;
  }

  #terminal-pre::-webkit-scrollbar-thumb {
    background: #00ff88;
    border-radius: 3px;
  }
</style>

<script is:inline type="module">
  // comandos sobrios y profesionales (sin ruido innecesario)
  const CMDS = [
    "nmap -sV -sC 10.10.154.180",
    "gobuster dir -u http://target -w common.txt",
    "curl -I http://10.10.154.180",
  ];

  const OUTPUTS = {
    "nmap -sV -sC 10.10.154.180": `Nmap scan report for 10.10.154.180
Host is up (0.21s latency).
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu
80/tcp   open  http    Apache httpd 2.4.29
Service Info: OS: Linux`,

    "gobuster dir -u http://target -w common.txt": `Gobuster v3.5
===============================================================
/admin   (301)
/login   (200)
/uploads (301)
===============================================================`,

    "curl -I http://10.10.154.180": `HTTP/1.1 200 OK
Server: Apache/2.4.29 (Ubuntu)
X-Powered-By: PHP/7.2.24`,
  };

  function startTerminal() {
    const outEl = document.getElementById("terminal-output");
    const curEl = document.getElementById("terminal-cursor");
    if (!outEl || !curEl) return;

    let cmdIndex = 0;
    let mode = "typing";
    let i = 0;

    const TYPE_DELAY = 35;
    const LINE_DELAY = 70;
    const AFTER_CMD_DELAY = 1200;
    const BETWEEN_CMD_DELAY = 400;
    const PAUSE_AFTER_LOOP = 4000;

    function tick() {
      const cmd = CMDS[cmdIndex] || "";

      if (mode === "typing") {
        outEl.textContent = `$ ${cmd.slice(0, i)}`;
        i++;
        if (i <= cmd.length) {
          setTimeout(tick, TYPE_DELAY);
          return;
        }
        mode = "output";
        i = 0;
        setTimeout(tick, 400);
        return;
      }

      if (mode === "output") {
        const text = OUTPUTS[cmd] || "";
        const lines = text.split("\n");
        outEl.textContent =
          `$ ${cmd}\n` + lines.slice(0, i + 1).join("\n");
        i++;
        if (i < lines.length) {
          setTimeout(tick, LINE_DELAY);
          return;
        }
        mode = "next";
        setTimeout(tick, AFTER_CMD_DELAY);
        return;
      }

      // next command or pause
      if (cmdIndex === CMDS.length - 1) {
        cmdIndex = 0;
        mode = "typing";
        i = 0;
        outEl.textContent = "";
        setTimeout(tick, PAUSE_AFTER_LOOP);
        return;
      }

      cmdIndex++;
      mode = "typing";
      i = 0;
      outEl.textContent = "";
      setTimeout(tick, BETWEEN_CMD_DELAY);
    }

    setTimeout(tick, 400);
  }

  const boot = () => startTerminal();

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", boot, { once: true });
  } else {
    boot();
  }

  window.addEventListener?.("astro:after-swap", boot);
</script>
