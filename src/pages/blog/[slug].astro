---
import Layout from "@/layouts/Layout.astro";
import Section from "@/components/Section.astro";
import { getCollection } from "astro:content";

// Genera las rutas estáticas para cada post de la colección "blog"
export async function getStaticPaths() {
  const posts = await getCollection("blog", (p) => p.data?.draft !== true);
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },              // ← PASAMOS "post"
  }));
}

// Recibimos "post" (no "entry")
const { post } = Astro.props;
const { Content } = await post.render();

const dateStr = post.data.pubDate
  ? new Date(post.data.pubDate).toLocaleDateString("es-AR", {
      year: "numeric", month: "long", day: "2-digit"
    })
  : null;
---

<Layout title={post.data.title}>
  <Section title={post.data.title}>
    <a href={import.meta.env.BASE_URL + "blog/"} class="back">&larr; Volver al blog</a>

    <article class="post">
      <header class="post-header">
        <h1 class="post-title">{post.data.title}</h1>
        <p class="post-meta">
          {dateStr && <>Publicado: {dateStr}</>}
          {post.data.description && <span class="post-lead"> — {post.data.description}</span>}
        </p>
      </header>

      <div class="post-prose">
        <Content />
      </div>

      {post.data.tags?.length ? (
        <div class="post-prose" style="padding-top:0">
          <strong>Tags:</strong>
          <div class="mt-2 flex flex-wrap gap-2">
            {post.data.tags.map((t: string) => (
              <span class="px-2 py-0.5 text-xs bg-white/10 rounded-full">#{t}</span>
            ))}
          </div>
        </div>
      ) : null}
    </article>
  </Section>
</Layout>

<style is:global>
  :root { --card:#11161b; --border:rgba(255,255,255,.12); --text:#e6edf3; --accent:#07ff8b; }
  .back{display:inline-block;margin:.2rem 0 1.6rem;font:13px/1 ui-monospace,Menlo,Consolas,monospace;color:var(--accent);
    border-bottom:1px dashed rgba(7,255,139,.5);text-decoration:none;}
  .post{background:linear-gradient(180deg,color-mix(in oklab,var(--card) 94%,transparent 6%),var(--card));
    border:1px solid var(--border);border-radius:14px;box-shadow:0 10px 28px rgba(0,0,0,.38);overflow:hidden;}
  .post-header{padding:1.5rem 1.6rem 1.2rem;border-bottom:1px solid rgba(255,255,255,.08);}
  .post-title{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:clamp(2rem,2.6vw,2.6rem);margin:.2rem 0 .5rem;color:#f4f8f7;}
  .post-meta{color:rgba(255,255,255,.68);margin:.3rem 0 0;}
  .post-lead{color:rgba(255,255,255,.86);}
  .post-prose{padding:1.8rem 1.9rem 2.1rem;color:var(--text);line-height:1.85;}
  .post-prose p,.post-prose ul,.post-prose ol,.post-prose pre,.post-prose blockquote,.post-prose table{
    margin-top:1.5rem !important;margin-bottom:1.5rem !important;}
  .post-prose h2,.post-prose h3,.post-prose h4{
    all:unset;display:block;font-weight:600;line-height:1.35;font-family:ui-monospace,Menlo,Consolas,monospace !important;}
  .post-prose h2{font-size:1.9rem !important;color:var(--accent) !important;margin:2.8rem 0 1.4rem !important;
    padding-bottom:.4rem !important;border-bottom:1px solid rgba(255,255,255,.2) !important;}
  .post-prose h3{font-size:1.45rem !important;color:#e7fbf2 !important;margin:2.2rem 0 1rem !important;
    padding-left:.8rem !important;border-left:3px solid rgba(7,255,139,.5) !important;}
  .post-prose h4{font-size:1.2rem !important;margin:1.6rem 0 1rem !important;color:#cdd7dd !important;}
  .post-prose a{color:var(--accent);text-decoration:none;border-bottom:1px dashed rgba(7,255,139,.5);}
  .post-prose ul,.post-prose ol{padding-left:1.5rem;}
  .post-prose table{width:100%;border:1px solid rgba(255,255,255,.16);border-radius:.6rem;overflow:hidden;margin:1.4rem 0 1.6rem;}
  .post-prose thead th{background:rgba(255,255,255,.08);color:#e9f6f2;}
  .post-prose th,.post-prose td{padding:.8rem .9rem;border-bottom:1px solid rgba(255,255,255,.10);}
  .post-prose blockquote{margin:1.8rem 0;padding:1rem 1.2rem;border-left:4px solid var(--accent);border-radius:10px;
    background:rgba(255,255,255,.05);color:#dce6e4;}
  .post-prose :not(pre)>code{font:12px/1.45 ui-monospace,Menlo,Consolas,monospace;padding:2px 6px;border-radius:6px;
    background:#0b0f13;border:1px solid rgba(255,255,255,.14);}
  .post-prose pre,.post-prose pre.astro-code{position:relative;margin:1.8rem 0;padding:1.2rem 1.3rem;border-radius:.8rem;
    border:1px solid rgba(255,255,255,.16);background:#0b0f13;overflow:auto;}
</style>
