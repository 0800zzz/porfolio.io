---
import Layout from "@/layouts/Layout.astro";
import Section from "@/components/Section.astro";
import BlogPostCard from "@/components/BlogPostCard.astro";
import Hero from "@/components/Hero.astro";
import Stats from "@/components/Stats.astro";
import Terminal from "@/components/Terminal.astro";
import { KNOWN_TECH, ABOUT_ME } from "@/consts";
import { getCollection } from "astro:content";

const base = import.meta.env.BASE_URL;

// cargar posts
let posts: any[] = [];
try { posts = await getCollection("blog"); } catch { posts = []; }

posts = posts
  .filter((p) => !p.data.draft)
  .sort((a, b) => {
    const ad = a?.data?.pubDate ? new Date(a.data.pubDate).valueOf() : 0;
    const bd = b?.data?.pubDate ? new Date(b.data.pubDate).valueOf() : 0;
    return bd - ad;
  });

// limitar cantidad de posts a mostrar
const LIMIT = 6;               // ðŸ‘ˆ podÃ©s cambiar a 8
const latest = posts.slice(0, LIMIT);
---

<Layout title="porfolio.io">
  <Hero title="Emiliano Carrizo" subtitle="Pentesting â€¢ Purple Team â€¢ Writeups" matrix={true} />

  <!-- Stats -->
  <Section id="stats">
    <Stats />
  </Section>

  <!-- Blog -->
  <Section title="ls blog">
    {latest.length === 0 ? (
      <p class="text-center text-white/60 font-mono">Sin entradas aÃºn.</p>
    ) : (
      <>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          {latest.map((p) => (
            <BlogPostCard
              href={`${base}blog/${p.slug}/`}
              title={p.data.title}
              excerpt={p.data.description}
              date={p.data.pubDate}
              tags={p.data.tags}
            />
          ))}
        </div>

        <div class="mt-6 text-center">
          <a
            href={`${base}blog/`}
            class="inline-block font-mono text-xs text-emerald-300 border border-emerald-400/30 rounded px-3 py-2 hover:bg-emerald-400/10"
            >[ VER TODOS LOS POSTS ]</a
          >
        </div>
      </>
    )}
  </Section>

  <!-- Terminal -->
  <Section title="bin/bash" id="terminal" full_screen={false}>
    <Terminal />
  </Section>

  <!-- Skills -->
<Section id="skills"  title="ls /skill">
    <div class="flex flex-wrap justify-center gap-3">
      {KNOWN_TECH.map((x) => (
        <span class="px-3 py-1 rounded-full bg-white/10 border border-white/20 backdrop-blur text-sm font-mono flex items-center gap-2">
          <span class="text-white/90">{x}</span>
          <span class="inline-block w-4 h-4 rounded-full bg-white/85 text-black grid place-items-center text-[10px]">âœ“</span>
        </span>
      ))}
    </div>
  </Section>

  <!-- About -->
  <Section  title="whoami" id="about">
    <div class="w-full grid place-items-center">
      <div class="max-w-4xl text-xl md:text-lg opacity-90 text-center justify-evenly">
        <p>{ABOUT_ME}</p>
      </div>
    </div>
  </Section>
</Layout>
